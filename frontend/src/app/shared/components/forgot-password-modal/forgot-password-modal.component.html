<div class="modal-header bg-light">
  <h4 class="modal-title">
    <i class="fas fa-key text-primary me-2"></i>
    Recuperar contraseÃ±a
  </h4>
  <button type="button" class="btn-close" aria-label="Close" (click)="dismiss()"></button>
</div>

<div class="modal-body p-4">
  <div class="text-center mb-4">
    <div class="avatar-circle mx-auto mb-3 bg-primary-soft">
      <i class="fas fa-envelope fa-2x text-primary"></i>
    </div>
    <h5>Â¿OlvidÃ³ su contraseÃ±a?</h5>
    <p class="text-muted">Ingrese su correo electrÃ³nico y le enviaremos instrucciones para restablecer su contraseÃ±a</p>
  </div>

  <div class="alert alert-success" *ngIf="successMessage">
    {{ successMessage }}
  </div>

  <div class="alert alert-danger" *ngIf="error">
    {{ error }}
  </div>

  <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" *ngIf="!successMessage">
    <div class="form-floating mb-4">
      <input 
        type="email" 
        class="form-control" 
        id="email" 
        formControlName="email" 
        placeholder="Correo electrÃ³nico"
        [ngClass]="{'is-invalid': emailControl?.invalid && emailControl?.touched}">
      <label for="email">Correo electrÃ³nico</label>
      <div class="invalid-feedback" *ngIf="emailControl?.errors?.['required'] && emailControl?.touched">
        El correo electrÃ³nico es obligatorio
      </div>
      <div class="invalid-feedback" *ngIf="emailControl?.errors?.['email'] && emailControl?.touched">
        Por favor, ingrese un correo electrÃ³nico vÃ¡lido
      </div>
    </div>

    <div class="d-grid gap-2">
      <button 
        type="submit" 
        class="btn btn-primary rounded-pill py-2"
        [disabled]="forgotPasswordForm.invalid || loading">
        <span *ngIf="!loading">Enviar instrucciones</span>
        <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        <span *ngIf="loading">Enviando...</span>
      </button>
      <button 
        type="button" 
        class="btn btn-outline-secondary rounded-pill py-2"
        (click)="backToLogin()">
        Volver al inicio de sesiÃ³n
      </button>
    </div>
  </form>

  <div class="mt-3" *ngIf="successMessage">
    <div class="alert alert-info" *ngIf="resetLink">Si no recibiste el correo, puedes abrir el enlace directamente.</div>
    <div class="d-grid gap-2 mb-2" *ngIf="resetLink">
      <button type="button" class="btn btn-primary rounded-pill py-2" (click)="openResetLink()">Abrir enlace de restablecimiento</button>
      <button type="button" class="btn btn-outline-secondary rounded-pill py-2" (click)="copyResetLink()">Copiar enlace</button>
      <div class="text-success" *ngIf="copied"><small>Enlace copiado</small></div>
    </div>
  </div>
  <div class="text-center mt-3" *ngIf="successMessage">
    <button 
      type="button" 
      class="btn btn-primary rounded-pill py-2"
      (click)="backToLogin()">
      Volver al inicio de sesiÃ³n
    </button>
  </div>
</div>

<div class="modal-footer bg-light">
  <div class="w-100 text-center">
    <p class="text-muted mb-0">
      <small>
        <i class="fas fa-lock me-1"></i> ConexiÃ³n segura | IMPROVEMENT SOLUTIONS Â© 2025
      </small>
    </p>
  </div>
</div>
