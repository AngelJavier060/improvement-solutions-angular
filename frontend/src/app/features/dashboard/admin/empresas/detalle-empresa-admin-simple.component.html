<div class="container-fluid p-4" *ngIf="!loading && empresa">
  
  <!-- Header de la empresa -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-auto">
          <img 
            [src]="getLogoUrl()" 
            [alt]="'Logo ' + empresa.name"
            class="rounded"
            style="width: 70px; height: 70px; object-fit: cover;">
        </div>
        <div class="col">
          <h4 class="mb-1">{{ empresa.name }}</h4>
          <p class="text-muted mb-0">RUC: {{ empresa.ruc }}</p>
          <p class="text-muted mb-0">{{ empresa.email || 'No especificado' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección principal: Gestión de Usuarios -->
  <div class="card">
    <div class="card-header bg-primary text-white">
      <div class="row align-items-center">
        <div class="col">
          <h5 class="mb-0">
            <i class="fas fa-users me-2"></i>
            Gestión de Usuarios
          </h5>
        </div>
        <div class="col-auto">
          <button 
            class="btn btn-light btn-sm"
            (click)="openCreateUserModal()">
            <i class="fas fa-plus"></i> Nuevo Usuario
          </button>
        </div>
      </div>
    </div>
    <div class="card-body">
      
      <!-- Lista de usuarios -->
      <div *ngIf="users.length === 0" class="text-center py-4">
        <i class="fas fa-users fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">No hay usuarios registrados</h5>
        <p class="text-muted">Crea el primer usuario para esta empresa</p>
        <button 
          class="btn btn-primary"
          (click)="openCreateUserModal()">
          <i class="fas fa-plus"></i> Crear Usuario
        </button>
      </div>

      <div *ngIf="users.length > 0" class="table-responsive">
        <table class="table table-hover">
          <thead class="table-light">
            <tr>
              <th>Usuario</th>
              <th>Email</th>
              <th>Departamento</th>
              <th>Estado</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>
                <div class="d-flex align-items-center">
                  <div class="avatar avatar-sm rounded-circle bg-primary text-white me-2">
                    {{ user.firstName?.charAt(0)?.toUpperCase() || 'U' }}
                  </div>
                  <div>
                    <div class="fw-medium">{{ user.firstName }} {{ user.lastName }}</div>
                    <small class="text-muted">{{ user.username }}</small>
                  </div>
                </div>
              </td>
              <td>{{ user.email }}</td>
              <td>{{ user.departmentName || 'No asignado' }}</td>
              <td>
                <span class="badge" 
                      [class]="user.isActive ? 'bg-success' : 'bg-danger'">
                  {{ user.isActive ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              <td class="text-center">
                <button 
                  class="btn btn-sm btn-outline-primary me-1"
                  (click)="openEditUserModal(user)"
                  title="Editar">
                  <i class="fas fa-edit"></i>
                </button>
                <button 
                  class="btn btn-sm btn-outline-danger"
                  (click)="deleteUser(user.id)"
                  title="Eliminar">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Loading state -->
<div *ngIf="loading" class="d-flex justify-content-center align-items-center" style="min-height: 400px;">
  <div class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2">Cargando detalles de la empresa...</p>
  </div>
</div>

<!-- Error state -->
<div *ngIf="error" class="alert alert-danger" role="alert">
  <i class="fas fa-exclamation-triangle"></i>
  {{ error }}
</div>

<!-- Modal para crear/editar usuario -->
<app-user-modal
  [show]="showUserModal"
  [user]="userToEdit"
  [businessId]="empresaId"
  [departments]="departamentos"
  (close)="showUserModal = false; userToEdit = null"
  (save)="onUserSaved($event)">
</app-user-modal>
