<div class="talento-humano-charts">

  <!-- Loading state -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2 text-muted">Cargando estadísticas de personal...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="reloadStats()">
      <i class="fas fa-redo me-1"></i>
      Reintentar
    </button>
  </div>

  <!-- Grid de tiles -->
  <div *ngIf="!loading && !error && statsData" class="th-grid">
    <!-- Tile 1: Total del personal -->
    <div class="th-tile">
      <div class="tile-header">
        <div class="tile-title">TOTAL DEL PERSONAL</div>
        <div class="tile-total"><i class="fas fa-users me-1"></i>{{ getCurrentStats().total }}</div>
      </div>
      <div class="tile-body gender-tile">
        <!-- Iconos Mujer / Hombre -->
        <div class="gender-icons">
          <!-- Mujer -->
          <div class="gender-icon">
            <svg width="120" height="180" viewBox="0 0 140 220" class="mb-2">
              <defs>
                <linearGradient id="womanGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" stop-color="#EC407A" />
                  <stop offset="100%" stop-color="#C2185B" />
                </linearGradient>
                <filter id="wShadow">
                  <feDropShadow dx="0" dy="3" stdDeviation="2" flood-opacity="0.3" />
                </filter>
              </defs>
              <circle cx="70" cy="30" r="22" fill="url(#womanGradient)" filter="url(#wShadow)" />
              <ellipse cx="70" cy="52" rx="8" ry="5" fill="#EC407A" />
              <path d="M 45 55 Q 50 52 70 52 Q 90 52 95 55 L 88 85 L 52 85 Z" fill="url(#womanGradient)" filter="url(#wShadow)" />
              <ellipse cx="70" cy="85" rx="18" ry="8" fill="#D81B60" />
              <path d="M 52 85 Q 40 120 35 150 L 105 150 Q 100 120 88 85 Z" fill="url(#womanGradient)" filter="url(#wShadow)" />
              <rect x="48" y="150" width="16" height="60" fill="#EC407A" rx="8" filter="url(#wShadow)" />
              <rect x="76" y="150" width="16" height="60" fill="#EC407A" rx="8" filter="url(#wShadow)" />
              <ellipse cx="56" cy="210" rx="10" ry="5" fill="#C2185B" />
              <ellipse cx="84" cy="210" rx="10" ry="5" fill="#C2185B" />
            </svg>
            <div class="gender-pct women">{{ genderPct.mujeres }}%</div>
            <div class="gender-label">Mujeres</div>
          </div>

          <!-- Hombre -->
          <div class="gender-icon">
            <svg width="120" height="180" viewBox="0 0 140 220" class="mb-2">
              <defs>
                <linearGradient id="manGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" stop-color="#42A5F5" />
                  <stop offset="100%" stop-color="#1976D2" />
                </linearGradient>
                <filter id="mShadow">
                  <feDropShadow dx="0" dy="3" stdDeviation="2" flood-opacity="0.3" />
                </filter>
              </defs>
              <circle cx="70" cy="30" r="22" fill="url(#manGradient)" filter="url(#mShadow)" />
              <rect x="62" y="50" width="16" height="8" fill="#42A5F5" rx="3" />
              <path d="M 50 58 L 45 110 L 95 110 L 90 58 Z" fill="url(#manGradient)" filter="url(#mShadow)" />
              <circle cx="45" cy="65" r="8" fill="#64B5F6" />
              <circle cx="95" cy="65" r="8" fill="#64B5F6" />
              <rect x="32" y="65" width="10" height="50" fill="#42A5F5" rx="5" filter="url(#mShadow)" />
              <rect x="98" y="65" width="10" height="50" fill="#42A5F5" rx="5" filter="url(#mShadow)" />
              <circle cx="37" cy="115" r="6" fill="#64B5F6" />
              <circle cx="103" cy="115" r="6" fill="#64B5F6" />
              <rect x="45" y="108" width="50" height="4" fill="#1565C0" />
              <rect x="50" y="112" width="16" height="88" fill="#1976D2" rx="8" filter="url(#mShadow)" />
              <rect x="74" y="112" width="16" height="88" fill="#1976D2" rx="8" filter="url(#mShadow)" />
              <ellipse cx="58" cy="200" rx="12" ry="6" fill="#0D47A1" />
              <ellipse cx="82" cy="200" rx="12" ry="6" fill="#0D47A1" />
            </svg>
            <div class="gender-pct men">{{ genderPct.hombres }}%</div>
            <div class="gender-label">Hombres</div>
          </div>
        </div>

        <!-- Barra de progreso -->
        <div class="gender-progress" aria-label="Distribución por género">
          <div class="women" [style.width.%]="genderPct.mujeres">{{ genderPct.mujeres > 12 ? (genderPct.mujeres + '%') : '' }}</div>
          <div class="men" [style.width.%]="genderPct.hombres">{{ genderPct.hombres > 12 ? (genderPct.hombres + '%') : '' }}</div>
          <div class="others" [style.width.%]="genderPct.otros">{{ genderPct.otros > 12 ? (genderPct.otros + '%') : '' }}</div>
        </div>
      </div>
    </div>

    <!-- Tile 2: Distribución por Edad y Género (Pirámide) -->
    <div class="th-tile">
      <div class="tile-header">
        <div class="tile-title">DISTRIBUCIÓN POR EDAD Y GÉNERO</div>
      </div>
      <div class="tile-body pyramid-layout">
        <!-- Lado Mujeres -->
        <div class="pyramid-side">
          <svg width="120" height="180" viewBox="0 0 140 220" class="mb-2">
            <defs>
              <linearGradient id="pyrWomanGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#EC407A" />
                <stop offset="100%" stop-color="#C2185B" />
              </linearGradient>
              <filter id="pyrWShadow">
                <feDropShadow dx="0" dy="3" stdDeviation="2" flood-opacity="0.3" />
              </filter>
            </defs>
            <circle cx="70" cy="30" r="22" fill="url(#pyrWomanGradient)" filter="url(#pyrWShadow)" />
            <ellipse cx="70" cy="52" rx="8" ry="5" fill="#EC407A" />
            <path d="M 45 55 Q 50 52 70 52 Q 90 52 95 55 L 88 85 L 52 85 Z" fill="url(#pyrWomanGradient)" filter="url(#pyrWShadow)" />
            <ellipse cx="70" cy="85" rx="18" ry="8" fill="#D81B60" />
            <path d="M 52 85 Q 40 120 35 150 L 105 150 Q 100 120 88 85 Z" fill="url(#pyrWomanGradient)" filter="url(#pyrWShadow)" />
            <rect x="48" y="150" width="16" height="60" fill="#EC407A" rx="8" filter="url(#pyrWShadow)" />
            <rect x="76" y="150" width="16" height="60" fill="#EC407A" rx="8" filter="url(#pyrWShadow)" />
            <ellipse cx="56" cy="210" rx="10" ry="5" fill="#C2185B" />
            <ellipse cx="84" cy="210" rx="10" ry="5" fill="#C2185B" />
          </svg>
          <div class="pyramid-label women">MUJERES</div>
        </div>

        <!-- Centro: Gráfico -->
        <div class="pyramid-chart">
          <div echarts [options]="pyramidOptions" [autoResize]="true" class="tile-chart"></div>
        </div>

        <!-- Lado Hombres -->
        <div class="pyramid-side">
          <svg width="120" height="180" viewBox="0 0 140 220" class="mb-2">
            <defs>
              <linearGradient id="pyrManGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#42A5F5" />
                <stop offset="100%" stop-color="#1976D2" />
              </linearGradient>
              <filter id="pyrMShadow">
                <feDropShadow dx="0" dy="3" stdDeviation="2" flood-opacity="0.3" />
              </filter>
            </defs>
            <circle cx="70" cy="30" r="22" fill="url(#pyrManGradient)" filter="url(#pyrMShadow)" />
            <rect x="62" y="50" width="16" height="8" fill="#42A5F5" rx="3" />
            <path d="M 50 58 L 45 110 L 95 110 L 90 58 Z" fill="url(#pyrManGradient)" filter="url(#pyrMShadow)" />
            <circle cx="45" cy="65" r="8" fill="#64B5F6" />
            <circle cx="95" cy="65" r="8" fill="#64B5F6" />
            <rect x="32" y="65" width="10" height="50" fill="#42A5F5" rx="5" filter="url(#pyrMShadow)" />
            <rect x="98" y="65" width="10" height="50" fill="#42A5F5" rx="5" filter="url(#pyrMShadow)" />
            <circle cx="37" cy="115" r="6" fill="#64B5F6" />
            <circle cx="103" cy="115" r="6" fill="#64B5F6" />
            <rect x="45" y="108" width="50" height="4" fill="#1565C0" />
            <rect x="50" y="112" width="16" height="88" fill="#1976D2" rx="8" filter="url(#pyrMShadow)" />
            <rect x="74" y="112" width="16" height="88" fill="#1976D2" rx="8" filter="url(#pyrMShadow)" />
            <ellipse cx="58" cy="200" rx="12" ry="6" fill="#0D47A1" />
            <ellipse cx="82" cy="200" rx="12" ry="6" fill="#0D47A1" />
          </svg>
          <div class="pyramid-label men">HOMBRES</div>
        </div>
      </div>
    </div>

    <!-- Tile 3: Género (Donut) -->
    <div class="th-tile">
      <div class="tile-header">
        <div class="tile-title">GÉNERO</div>
        <div class="tile-total"><i class="fas fa-venus-mars me-1"></i>{{ getCurrentStats().total }}</div>
      </div>
      <div class="tile-body">
        <div echarts [options]="donutGeneroOptions" [autoResize]="true" class="tile-chart donut"></div>
      </div>
    </div>

    <!-- Placeholder temporal (solo uno) -->
    <div class="th-tile" *ngFor="let _ of [1]">
      <div class="tile-header"><div class="tile-title">&nbsp;</div></div>
      <div class="tile-body placeholder"></div>
    </div>
  </div>

  <!-- No data state -->
  <div *ngIf="!loading && !error && statsData && getCurrentStats().total === 0" class="no-data-container">
    <div class="text-center py-5">
      <i class="fas fa-users fa-3x text-muted mb-3"></i>
      <h4 class="text-muted">No hay empleados registrados</h4>
      <p class="text-muted">Agregue empleados para ver las estadísticas de personal.</p>
    </div>
  </div>
</div>
