"use strict";(self.webpackChunkimprovement_solutions=self.webpackChunkimprovement_solutions||[]).push([[637],{3637:(T,l,s)=>{s.r(l),s.d(l,{ForgotPasswordModalComponent:()=>I});var a=s(4341),u=s(5621),_=s(9437),f=s(7673),o=s(4438),c=s(4512),g=s(8010),d=s(177);const p=t=>({"is-invalid":t});function v(t,i){if(1&t&&(o.j41(0,"div",17),o.EFF(1),o.k0s()),2&t){const e=o.XpG();o.R7$(),o.SpI(" ",e.successMessage," ")}}function b(t,i){if(1&t&&(o.j41(0,"div",18),o.EFF(1),o.k0s()),2&t){const e=o.XpG();o.R7$(),o.SpI(" ",e.error," ")}}function F(t,i){1&t&&(o.j41(0,"div",29),o.EFF(1," El correo electr\xf3nico es obligatorio "),o.k0s())}function h(t,i){1&t&&(o.j41(0,"div",29),o.EFF(1," Por favor, ingrese un correo electr\xf3nico v\xe1lido "),o.k0s())}function C(t,i){1&t&&(o.j41(0,"span"),o.EFF(1,"Enviar instrucciones"),o.k0s())}function k(t,i){1&t&&o.nrm(0,"span",30)}function E(t,i){1&t&&(o.j41(0,"span"),o.EFF(1,"Enviando..."),o.k0s())}function M(t,i){if(1&t){const e=o.RV6();o.j41(0,"form",19),o.bIt("ngSubmit",function(){o.eBV(e);const n=o.XpG();return o.Njj(n.onSubmit())}),o.j41(1,"div",20),o.nrm(2,"input",21),o.j41(3,"label",22),o.EFF(4,"Correo electr\xf3nico"),o.k0s(),o.DNE(5,F,2,0,"div",23)(6,h,2,0,"div",23),o.k0s(),o.j41(7,"div",24)(8,"button",25),o.DNE(9,C,2,0,"span",26)(10,k,1,0,"span",27)(11,E,2,0,"span",26),o.k0s(),o.j41(12,"button",28),o.bIt("click",function(){o.eBV(e);const n=o.XpG();return o.Njj(n.backToLogin())}),o.EFF(13," Volver al inicio de sesi\xf3n "),o.k0s()()()}if(2&t){const e=o.XpG();o.Y8G("formGroup",e.forgotPasswordForm),o.R7$(2),o.Y8G("ngClass",o.eq3(8,p,(null==e.emailControl?null:e.emailControl.invalid)&&(null==e.emailControl?null:e.emailControl.touched))),o.R7$(3),o.Y8G("ngIf",(null==e.emailControl||null==e.emailControl.errors?null:e.emailControl.errors.required)&&(null==e.emailControl?null:e.emailControl.touched)),o.R7$(),o.Y8G("ngIf",(null==e.emailControl||null==e.emailControl.errors?null:e.emailControl.errors.email)&&(null==e.emailControl?null:e.emailControl.touched)),o.R7$(2),o.Y8G("disabled",e.forgotPasswordForm.invalid||e.loading),o.R7$(),o.Y8G("ngIf",!e.loading),o.R7$(),o.Y8G("ngIf",e.loading),o.R7$(),o.Y8G("ngIf",e.loading)}}function P(t,i){if(1&t){const e=o.RV6();o.j41(0,"div",31)(1,"button",32),o.bIt("click",function(){o.eBV(e);const n=o.XpG();return o.Njj(n.backToLogin())}),o.EFF(2," Volver al inicio de sesi\xf3n "),o.k0s()()}}let I=(()=>{class t{constructor(e,r,n,m){this.fb=e,this.activeModal=r,this.authService=n,this.modalService=m,this.loading=!1,this.error="",this.successMessage="",this.resetToken=""}ngOnInit(){this.forgotPasswordForm=this.fb.group({email:["",[a.k0.required,a.k0.email]]})}get emailControl(){return this.forgotPasswordForm.get("email")}onSubmit(){if(this.forgotPasswordForm.invalid)return;this.loading=!0,this.error="";const e=this.forgotPasswordForm.get("email").value;this.authService.requestPasswordReset(e).pipe((0,_.W)(r=>{if(console.log("Error al solicitar restablecimiento. Usando modo de prueba local:",r),"javierangelmsn@outlook.es"===e||"javier@test.com"===e){const n="test-token-"+Math.floor(1e4*Math.random());return(0,f.of)({mensaje:"Se ha enviado un correo electr\xf3nico con las instrucciones para restablecer su contrase\xf1a",token:n})}throw r})).subscribe({next:r=>{this.loading=!1,this.successMessage="Se han enviado instrucciones a su correo electr\xf3nico para restablecer la contrase\xf1a.",r&&r.token&&(this.resetToken=r.token,console.log("Token para restablecer contrase\xf1a (solo para desarrollo):",r.token),this.successMessage+=" Para efectos de desarrollo, puede usar este token: "+r.token)},error:r=>{this.loading=!1,this.error=r.message||"Ocurri\xf3 un error al solicitar el restablecimiento de contrase\xf1a."}})}backToLogin(){try{this.activeModal.dismiss("go-back-to-login"),setTimeout(()=>{this.modalService.open(u.a,{centered:!0,backdrop:"static",keyboard:!1}).componentInstance.userType="usuario"},100)}catch(e){console.error("Error al volver al login:",e),window.location.href="/"}}dismiss(){try{this.activeModal.dismiss("user-dismissed")}catch(e){console.error("Error al cerrar el modal:",e),window.location.href="/"}}static{this.\u0275fac=function(r){return new(r||t)(o.rXU(a.ok),o.rXU(c.Lw),o.rXU(g.u),o.rXU(c.Bq))}}static{this.\u0275cmp=o.VBU({type:t,selectors:[["app-forgot-password-modal"]],decls:23,vars:4,consts:[[1,"modal-header","bg-light"],[1,"modal-title"],[1,"fas","fa-key","text-primary","me-2"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","p-4"],[1,"text-center","mb-4"],[1,"avatar-circle","mx-auto","mb-3","bg-primary-soft"],[1,"fas","fa-envelope","fa-2x","text-primary"],[1,"text-muted"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],["class","text-center mt-3",4,"ngIf"],[1,"modal-footer","bg-light"],[1,"w-100","text-center"],[1,"text-muted","mb-0"],[1,"fas","fa-lock","me-1"],[1,"alert","alert-success"],[1,"alert","alert-danger"],[3,"ngSubmit","formGroup"],[1,"form-floating","mb-4"],["type","email","id","email","formControlName","email","placeholder","Correo electr\xf3nico",1,"form-control",3,"ngClass"],["for","email"],["class","invalid-feedback",4,"ngIf"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary","rounded-pill","py-2",3,"disabled"],[4,"ngIf"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary","rounded-pill","py-2",3,"click"],[1,"invalid-feedback"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"text-center","mt-3"],["type","button",1,"btn","btn-primary","rounded-pill","py-2",3,"click"]],template:function(r,n){1&r&&(o.j41(0,"div",0)(1,"h4",1),o.nrm(2,"i",2),o.EFF(3," Recuperar contrase\xf1a "),o.k0s(),o.j41(4,"button",3),o.bIt("click",function(){return n.dismiss()}),o.k0s()(),o.j41(5,"div",4)(6,"div",5)(7,"div",6),o.nrm(8,"i",7),o.k0s(),o.j41(9,"h5"),o.EFF(10,"\xbfOlvid\xf3 su contrase\xf1a?"),o.k0s(),o.j41(11,"p",8),o.EFF(12,"Ingrese su correo electr\xf3nico y le enviaremos instrucciones para restablecer su contrase\xf1a"),o.k0s()(),o.DNE(13,v,2,1,"div",9)(14,b,2,1,"div",10)(15,M,14,10,"form",11)(16,P,3,0,"div",12),o.k0s(),o.j41(17,"div",13)(18,"div",14)(19,"p",15)(20,"small"),o.nrm(21,"i",16),o.EFF(22," Conexi\xf3n segura | IMPROVEMENT SOLUTIONS \xa9 2025 "),o.k0s()()()()),2&r&&(o.R7$(13),o.Y8G("ngIf",n.successMessage),o.R7$(),o.Y8G("ngIf",n.error),o.R7$(),o.Y8G("ngIf",!n.successMessage),o.R7$(),o.Y8G("ngIf",n.successMessage))},dependencies:[d.YU,d.bT,a.qT,a.me,a.BC,a.cb,a.j4,a.JD],styles:[".avatar-circle[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center}.bg-primary-soft[_ngcontent-%COMP%]{background-color:#0d6efd26}"]})}}return t})()}}]);