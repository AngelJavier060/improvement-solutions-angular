"use strict";(self.webpackChunkimprovement_solutions=self.webpackChunkimprovement_solutions||[]).push([[820],{820:(y,c,i)=>{i.r(c),i.d(c,{AuthModule:()=>j});var d=i(177),t=i(4341),l=i(7681),u=i(9437),m=i(7673),o=i(4438),p=i(8010);const f=r=>({"is-invalid":r});function w(r,a){if(1&r&&(o.j41(0,"div",19),o.EFF(1),o.j41(2,"div",20)(3,"a",21),o.EFF(4,"Volver al inicio"),o.k0s()()()),2&r){const s=o.XpG();o.R7$(),o.SpI(" ",s.successMessage," ")}}function h(r,a){1&r&&(o.j41(0,"div",20)(1,"a",24),o.EFF(2,"Volver al inicio"),o.k0s()())}function v(r,a){if(1&r&&(o.j41(0,"div",22),o.EFF(1),o.DNE(2,h,3,0,"div",23),o.k0s()),2&r){const s=o.XpG();o.R7$(),o.SpI(" ",s.error," "),o.R7$(),o.Y8G("ngIf",s.tokenInvalid)}}function g(r,a){1&r&&(o.j41(0,"div",38),o.EFF(1," La nueva contrase\xf1a es obligatoria "),o.k0s())}function P(r,a){1&r&&(o.j41(0,"div",38),o.EFF(1," La contrase\xf1a debe tener al menos 6 caracteres "),o.k0s())}function C(r,a){1&r&&(o.j41(0,"div",38),o.EFF(1," Por favor, confirma tu nueva contrase\xf1a "),o.k0s())}function F(r,a){1&r&&(o.j41(0,"div",38),o.EFF(1," Las contrase\xf1as no coinciden "),o.k0s())}function b(r,a){1&r&&(o.j41(0,"span"),o.EFF(1,"Guardar nueva contrase\xf1a"),o.k0s())}function k(r,a){1&r&&o.nrm(0,"span",39)}function R(r,a){1&r&&(o.j41(0,"span"),o.EFF(1,"Procesando..."),o.k0s())}function I(r,a){if(1&r){const s=o.RV6();o.j41(0,"form",25),o.bIt("ngSubmit",function(){o.eBV(s);const n=o.XpG();return o.Njj(n.onSubmit())}),o.j41(1,"div",26),o.nrm(2,"input",27),o.j41(3,"label",28),o.EFF(4,"Nueva contrase\xf1a"),o.k0s(),o.DNE(5,g,2,0,"div",29)(6,P,2,0,"div",29),o.k0s(),o.j41(7,"div",30),o.nrm(8,"input",31),o.j41(9,"label",32),o.EFF(10,"Confirmar contrase\xf1a"),o.k0s(),o.DNE(11,C,2,0,"div",29)(12,F,2,0,"div",29),o.k0s(),o.j41(13,"div",33)(14,"button",34),o.DNE(15,b,2,0,"span",35)(16,k,1,0,"span",36)(17,R,2,0,"span",35),o.k0s(),o.j41(18,"a",37),o.EFF(19,"Cancelar"),o.k0s()()()}if(2&r){const s=o.XpG();o.Y8G("formGroup",s.resetPasswordForm),o.R7$(2),o.Y8G("ngClass",o.eq3(11,f,(null==s.newPasswordControl?null:s.newPasswordControl.invalid)&&(null==s.newPasswordControl?null:s.newPasswordControl.touched))),o.R7$(3),o.Y8G("ngIf",(null==s.newPasswordControl||null==s.newPasswordControl.errors?null:s.newPasswordControl.errors.required)&&(null==s.newPasswordControl?null:s.newPasswordControl.touched)),o.R7$(),o.Y8G("ngIf",(null==s.newPasswordControl||null==s.newPasswordControl.errors?null:s.newPasswordControl.errors.minlength)&&(null==s.newPasswordControl?null:s.newPasswordControl.touched)),o.R7$(2),o.Y8G("ngClass",o.eq3(13,f,(null==s.confirmPasswordControl?null:s.confirmPasswordControl.invalid)&&(null==s.confirmPasswordControl?null:s.confirmPasswordControl.touched)||s.passwordsNotMatching())),o.R7$(3),o.Y8G("ngIf",(null==s.confirmPasswordControl||null==s.confirmPasswordControl.errors?null:s.confirmPasswordControl.errors.required)&&(null==s.confirmPasswordControl?null:s.confirmPasswordControl.touched)),o.R7$(),o.Y8G("ngIf",s.passwordsNotMatching()&&(null==s.confirmPasswordControl?null:s.confirmPasswordControl.touched)),o.R7$(2),o.Y8G("disabled",s.resetPasswordForm.invalid||s.loading||s.passwordsNotMatching()),o.R7$(),o.Y8G("ngIf",!s.loading),o.R7$(),o.Y8G("ngIf",s.loading),o.R7$(),o.Y8G("ngIf",s.loading)}}const x=[{path:"reset-password",component:(()=>{class r{constructor(s,e,n,E){this.fb=s,this.route=e,this.router=n,this.authService=E,this.token="",this.loading=!1,this.error="",this.successMessage="",this.tokenInvalid=!1}ngOnInit(){this.resetPasswordForm=this.fb.group({newPassword:["",[t.k0.required,t.k0.minLength(6)]],confirmPassword:["",[t.k0.required]]}),this.route.queryParams.subscribe(s=>{const e=s.token;if(!e)return this.error="No se proporcion\xf3 un token v\xe1lido.",void(this.tokenInvalid=!0);this.token=e,this.authService.validateResetToken(e).pipe((0,u.W)(n=>{if(console.log("Error al validar token. Usando modo de prueba local:",n),e.startsWith("test-token-"))return(0,m.of)({valid:!0});throw n})).subscribe({next:()=>{},error:n=>{this.error="El enlace para restablecer la contrase\xf1a es inv\xe1lido o ha expirado.",this.tokenInvalid=!0}})})}get newPasswordControl(){return this.resetPasswordForm.get("newPassword")}get confirmPasswordControl(){return this.resetPasswordForm.get("confirmPassword")}passwordsNotMatching(){const s=this.newPasswordControl?.value,e=this.confirmPasswordControl?.value;return s!==e&&!0===this.confirmPasswordControl?.touched}onSubmit(){this.resetPasswordForm.invalid||this.passwordsNotMatching()||(this.loading=!0,this.error="",this.authService.resetPassword({token:this.token,newPassword:this.newPasswordControl?.value,confirmPassword:this.confirmPasswordControl?.value}).pipe((0,u.W)(e=>{if(console.log("Error al restablecer contrase\xf1a. Usando modo de prueba local:",e),this.token.startsWith("test-token-"))return(0,m.of)({success:!0});throw e})).subscribe({next:()=>{this.loading=!1,this.successMessage="Tu contrase\xf1a ha sido restablecida exitosamente. Ahora puedes iniciar sesi\xf3n con tu nueva contrase\xf1a."},error:e=>{this.loading=!1,this.error=e.message||"Ocurri\xf3 un error al restablecer la contrase\xf1a."}}))}static{this.\u0275fac=function(e){return new(e||r)(o.rXU(t.ok),o.rXU(l.nX),o.rXU(l.Ix),o.rXU(p.u))}}static{this.\u0275cmp=o.VBU({type:r,selectors:[["app-reset-password"]],decls:25,vars:3,consts:[[1,"container"],[1,"row","justify-content-center","mt-5"],[1,"col-md-6","col-lg-5"],[1,"card","shadow"],[1,"card-header","bg-light"],[1,"text-center","mb-0"],[1,"fas","fa-key","text-primary","me-2"],[1,"card-body","p-4"],[1,"text-center","mb-4"],[1,"avatar-circle","mx-auto","mb-3","bg-primary-soft"],[1,"fas","fa-lock-open","fa-2x","text-primary"],[1,"text-muted"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"card-footer","bg-light"],[1,"w-100","text-center"],[1,"text-muted","mb-0"],[1,"fas","fa-lock","me-1"],[1,"alert","alert-success"],[1,"mt-3"],["routerLink","/",1,"btn","btn-primary","rounded-pill","py-2","w-100"],[1,"alert","alert-danger"],["class","mt-3",4,"ngIf"],["routerLink","/",1,"btn","btn-outline-primary","rounded-pill","py-2","w-100"],[3,"ngSubmit","formGroup"],[1,"form-floating","mb-3"],["type","password","id","newPassword","formControlName","newPassword","placeholder","Nueva contrase\xf1a",1,"form-control",3,"ngClass"],["for","newPassword"],["class","invalid-feedback",4,"ngIf"],[1,"form-floating","mb-4"],["type","password","id","confirmPassword","formControlName","confirmPassword","placeholder","Confirmar contrase\xf1a",1,"form-control",3,"ngClass"],["for","confirmPassword"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary","rounded-pill","py-2",3,"disabled"],[4,"ngIf"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],["routerLink","/",1,"btn","btn-outline-secondary","rounded-pill","py-2"],[1,"invalid-feedback"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,n){1&e&&(o.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),o.nrm(6,"i",6),o.EFF(7," Restablecer contrase\xf1a "),o.k0s()(),o.j41(8,"div",7)(9,"div",8)(10,"div",9),o.nrm(11,"i",10),o.k0s(),o.j41(12,"h5"),o.EFF(13,"Crea tu nueva contrase\xf1a"),o.k0s(),o.j41(14,"p",11),o.EFF(15,"Por favor, ingresa y confirma tu nueva contrase\xf1a"),o.k0s()(),o.DNE(16,w,5,1,"div",12)(17,v,3,2,"div",13)(18,I,20,15,"form",14),o.k0s(),o.j41(19,"div",15)(20,"div",16)(21,"p",17)(22,"small"),o.nrm(23,"i",18),o.EFF(24," Conexi\xf3n segura | IMPROVEMENT SOLUTIONS \xa9 2025 "),o.k0s()()()()()()()()),2&e&&(o.R7$(16),o.Y8G("ngIf",n.successMessage),o.R7$(),o.Y8G("ngIf",n.error),o.R7$(),o.Y8G("ngIf",!n.successMessage&&!n.tokenInvalid))},dependencies:[d.YU,d.bT,t.qT,t.me,t.BC,t.cb,t.j4,t.JD,l.Wk],styles:[".avatar-circle[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center}.bg-primary-soft[_ngcontent-%COMP%]{background-color:#0d6efd26}.container[_ngcontent-%COMP%]{padding-top:2rem;padding-bottom:4rem}"]})}}return r})()}];let j=(()=>{class r{static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275mod=o.$C({type:r})}static{this.\u0275inj=o.G2t({imports:[d.MD,t.X1,l.iI.forChild(x)]})}}return r})()}}]);